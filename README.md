# vite-plugin-vitepress-auto-nav

è‡ªåŠ¨ç”Ÿæˆ `VitePress` çš„ `nav` ä¸ `sidebar` é…ç½®

## âœ¨ åŠŸèƒ½

- æ”¯æŒè‡ªå®šä¹‰è¯»å–èŒƒå›´ï¼ˆåŸºäº `srcDir` ä¸ `srcExclude` é…ç½®ï¼‰
- å°†ä¸€çº§æ–‡ä»¶å¤¹ä½œä¸º `nav`ï¼Œå°†æ¬¡çº§æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ä½œä¸º `sidebar`
- æ”¯æŒæ’ä»¶é…ç½®ä¸æ–‡ç«  `frontmatter` é…ç½®ä¸¤ç§è‡ªå®šä¹‰æ–¹å¼
- æ”¯æŒè‡ªå®šä¹‰æ˜¾ç¤ºåç§°ï¼Œæ–‡ç« è¿˜æ”¯æŒä¸€çº§æ ‡é¢˜ä½œä¸ºåç§°
- æ”¯æŒè‡ªå®šä¹‰æ’åºæ–¹æ³•
- æ”¯æŒè‡ªå®šä¹‰éšè—æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹
- ä¿®æ”¹æ’ä»¶é…ç½®æˆ– `frontmatter` åè‡ªåŠ¨åˆ·æ–°

## ğŸ•¯ï¸ ä½¿ç”¨

1. å®‰è£…

```sh
# æ¨èä½¿ç”¨ pnpm
pnpm i vite-plugin-vitepress-auto-nav -D
# ä½¿ç”¨ ts æ—¶æ¨èå®‰è£… viteï¼Œå¦åˆ™ä¼šæœ‰ç±»å‹é”™è¯¯
pnpm i vite -D
```

2. æ·»åŠ æ’ä»¶

```ts
// .vitepress/config.ts
import AutoNav from "vite-plugin-vitepress-auto-nav";

export default defineConfig({
  vite: {
    plugins: [
      AutoNav({
        // è‡ªå®šä¹‰é…ç½®
      }),
    ],
  },
});
```

3. æ­£å¸¸å¯åŠ¨é¡¹ç›®å³å¯ä½¿ç”¨

## ğŸ› ï¸ é…ç½®

**åœ¨æ–‡ç«  `frontmatter` ä¸­ä¹Ÿå¯ä»¥é…ç½® `ItemOptions` ä¸­çš„å±æ€§ã€‚åŒæ—¶æ”¯æŒé…ç½®ä¸º `nav-å±æ€§å` çš„æ ¼å¼ï¼Œå¯ä»¥é¿å…ä¸é€»è¾‘ä¸­çš„å˜é‡é‡åã€‚å¯¹äº `frontmatter` ä¸­å…¶ä»–çš„å˜é‡ï¼Œä¹Ÿä¼šåŠ å…¥åˆ°æ’åºå‡½æ•°å‚æ•°çš„ `frontmatter` å±æ€§ä¸­**

```ts
interface Options {
  /**
   * glob åŒ¹é…è¡¨è¾¾å¼
   *
   * ä¼šåŒ¹é… vitepress é…ç½®ä¸­çš„ [srcDir] ç›®å½•ä¸‹ï¼Œé™¤ [srcExclude] å¤–æ»¡è¶³è¡¨è¾¾å¼çš„ md æ–‡ä»¶
   *
   * é»˜è®¤ï¼š**.md
   */
  pattern?: string | string[];
  /**
   * å¯¹ç‰¹å®šæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è¿›è¡Œé…ç½®
   *
   * é”®åä¸ºæ–‡ä»¶åã€æ–‡ä»¶å¤¹åæˆ–è·¯å¾„ï¼ˆä»¥ [srcDir] ä¸ºæ ¹ç›®å½•ï¼Œä»å¤–å±‚æ–‡ä»¶å¤¹å¾€é‡Œè¿›è¡ŒæŸ¥æ‰¾ï¼Œmd æ‰©å±•åå¯ä»¥çœç•¥ï¼›åç§°é‡å¤æ—¶ï¼Œç”¨è·¯å¾„åŒºåˆ†ï¼‰
   *
   * md æ–‡ä»¶çš„é…ç½®ä¹Ÿå¯ä»¥å†™åœ¨ frontmatter ä¸­ï¼Œä½¿ç”¨ç›¸åŒ `å±æ€§å`]` æˆ– `nav-å±æ€§å`ã€‚ä¼˜å…ˆçº§é«˜äº itemsSetting é…ç½®
   */
  itemsSetting?: Record<string, ItemOptions>;
  /**
   * è‡ªå®šä¹‰æ’åºæ–¹æ³•ï¼ŒåŒçº§æ–‡ä»¶ã€æ–‡ä»¶å¤¹ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°è¿›è¡Œæ’åº
   *
   * é»˜è®¤æ’åºæ–¹æ³• defaultCompareFn è§„åˆ™ä¸ºï¼š
   *
   * 1. éƒ½æœ‰ sort å€¼æ—¶ï¼Œå…ˆæŒ‰ sort å€¼å‡åºæ’åˆ—å†æŒ‰åˆ›å»ºæ—¶é—´å‡åºæ’åˆ—
   * 2. åªæœ‰ä¸€ä¸ªæœ‰ sort å€¼ï¼Œä¸” sort å€¼ç­‰äºå¦ä¸€ä¸ªçš„ä¸‹æ ‡å€¼æ—¶ï¼Œæœ‰ sort å€¼çš„åœ¨å‰
   * 3. åªæœ‰ä¸€ä¸ªæœ‰ sort å€¼ï¼Œä¸” sort å€¼ä¸ç­‰äºå¦ä¸€ä¸ªçš„ä¸‹æ ‡å€¼æ—¶ï¼Œå¯¹æ¯” sort å€¼ä¸ä¸‹æ ‡å€¼ï¼Œå‡åºæ’åˆ—
   * 4. éƒ½æ²¡æœ‰ sort å€¼æ—¶ï¼Œå¯¹æ¯”åˆ›å»ºæ—¶é—´ï¼ˆ`firstCommitTime` || `birthTime`ï¼‰é¡ºåºæ’åˆ—
   */
  compareFn?: (a: Item, b: Item) => number;
  /** æ˜¯å¦ä½¿ç”¨æ–‡ç« ä¸­çš„ä¸€çº§æ ‡é¢˜ä»£æ›¿æ–‡ä»¶åä½œä¸ºæ–‡ç« åç§°ï¼ˆå¤„ç†æ–‡ä»¶åå¯èƒ½æ˜¯ç®€å†™çš„æƒ…å†µï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨ itemsSetting ä¸­å•ç‹¬é…ç½® */
  useArticleTitle?: boolean;
}

/**
 * å•ä¸ªæ–‡ä»¶ã€æ–‡ä»¶å¤¹é…ç½®é¡¹
 *
 * ä¹Ÿæ”¯æŒåœ¨æ–‡ç« çš„ frontmatter ä¸­é…ç½® `åŒåå±æ€§` æˆ– `nav-å±æ€§å`ï¼Œä¼˜å…ˆçº§é«˜äº itemsSetting ä¸­çš„é…ç½®
 */
interface ItemOptions {
  /** æ˜¯å¦æ˜¾ç¤º */
  hide?: boolean;
  /** æ’åºå€¼ï¼ˆç›®æ ‡ä½ç½®ä¸‹æ ‡ï¼Œä»0å¼€å§‹ï¼‰ */
  sort?: number;
  /** é‡å®šä¹‰å±•ç¤ºåç§°ï¼Œä¼˜å…ˆçº§é«˜äº useArticleTitle */
  title?: string;
  /** æ˜¯å¦ä½¿ç”¨æ–‡ç« ä¸­çš„ä¸€çº§æ ‡é¢˜ä»£æ›¿æ–‡ä»¶åä½œä¸ºæ–‡ç« åç§°ï¼Œä¼˜äºå…¨å±€ useArticleTitle é…ç½® */
  useArticleTitle?: boolean;
  /**
   * åŒ sidebar ä¸­ collapsed é…ç½®ï¼Œåªå¯¹æ–‡ä»¶å¤¹ç”Ÿæ•ˆ
   *
   * é»˜è®¤ï¼šfalseï¼ˆæ”¯æŒæŠ˜å ï¼Œé»˜è®¤å±•å¼€ï¼‰
   */
  collapsed?: boolean;
}

/** æ–‡ä»¶ã€æ–‡ä»¶å¤¹å…³é”®ä¿¡æ¯ */
interface Item {
  /** åŒçº§ä¸­çš„ä½ç½®ä¸‹æ ‡ */
  index: number;
  /** æ–‡ä»¶ã€æ–‡ä»¶å¤¹å */
  name: string;
  /** æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ */
  isFolder: boolean;
  /** é…ç½®å¯¹è±¡(ä¸åŒ…æ‹¬frontmatter)ï¼Œä»¥åŠæ—¶é—´æˆ³æ•°æ®(TimesInfo) */
  options: ItemCacheOptions;
  /** frontmatter æ•°æ®ä»¥åŠæ–‡ç« ä¸€çº§æ ‡é¢˜ï¼ˆh1ï¼‰ */
  frontmatter: Frontmatter;
  /** å­æ–‡ä»¶ã€æ–‡ä»¶å¤¹ */
  children: Item[];
}

/** ç¼“å­˜çš„ options æ•°æ® */
type ItemCacheOptions = ItemOptions & TimesInfo;

/** æ–‡ä»¶ã€æ–‡ä»¶å¤¹æ—¶é—´æˆ³ä¿¡æ¯ */
interface TimesInfo {
  /** æœ¬åœ°æ–‡ä»¶åˆ›å»ºæ—¶é—´ */
  birthTime?: number;
  /** æœ¬åœ°æ–‡ä»¶ä¿®æ”¹æ—¶é—´ */
  modifyTime?: number;
  /** gité¦–æ¬¡æäº¤æ—¶é—´ï¼ˆä»…æ–‡ä»¶ï¼‰ */
  firstCommitTime?: number;
  /** gitæœ€åä¸€æ¬¡æäº¤æ—¶é—´ï¼ˆä»…æ–‡ä»¶ï¼‰ */
  lastCommitTime?: number;
}

/** ç¼“å­˜çš„ frontmatter æ•°æ® */
type Frontmatter = { h1?: string } & Recordable;

type Recordable = Record<string, any>;
```

> ç”Ÿæˆçš„ `nav` é…ç½®ï¼Œä¼šä½¿ç”¨ç›®å½•ä¸‹ç¬¬ä¸€ç¯‡æ–‡ç« ä½œä¸º `link` å±æ€§ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰ `nav` å¯ä»¥ç›´æ¥æ‰‹åŠ¨å®šä¹‰ï¼Œæ­¤æ—¶æ’ä»¶å°†ä¸ä¼šä¿®æ”¹å·²å­˜åœ¨çš„ `nav` é…ç½®ï¼ˆå› ä¸º `nav` é…ç½®é€šå¸¸è¾ƒå°‘ï¼Œæ‰‹åŠ¨é…ç½®ç›¸è¾ƒäºæ’ä»¶ä¸­è¿›è¡Œå¤æ‚çš„é…ç½®æ€§ä»·æ¯”æ›´é«˜ï¼‰

## ğŸŠ é…ç½®ç¤ºä¾‹

```ts
vite: {
  plugins: [
    AutoNav({
      pattern: ["**/!(README|TODO).md"], // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ’é™¤ä¸å±•ç¤ºçš„æ–‡ä»¶ï¼Œä¾‹å¦‚ä¸åŒ¹é… README å’Œ TODO æ–‡ä»¶
      settings: {
        a: { hide: true }, // ä¸æ˜¾ç¤ºåç§°ä¸º a çš„æ–‡ä»¶å¤¹æˆ– md æ–‡ä»¶
        b: { title: 'bb' }, // åç§°ä¸º b çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶åœ¨èœå•ä¸­æ˜¾ç¤ºä¸º bb
        c/b: { sort : 3 }, // é€šè¿‡è·¯å¾„ç²¾ç¡®åŒ¹é… c æ–‡ä»¶å¤¹ä¸‹çš„ b è¿›è¡Œé…ç½®ï¼Œæ’åºæ—¶ä½äºä¸‹æ ‡3çš„ä½ç½®æˆ–æœ€å
        c/b2: { useArticleTitle: false }, // å…³é—­ä½¿ç”¨æ–‡ç« ä¸€çº§æ ‡é¢˜ä½œä¸ºæ–‡ç« åç§°
        d: { collapsed: true }, // æ–‡ä»¶å¤¹æŠ˜å é…ç½®
      },
      compareFn: (a, b) => {
        // æŒ‰æœ€æ–°æäº¤æ—¶é—´(æ²¡æœ‰æäº¤è®°å½•æ—¶ä¸ºæœ¬åœ°æ–‡ä»¶ä¿®æ”¹æ—¶é—´)å‡åºæ’åˆ—
        return (b.options.lastCommitTime || b.options.modifyTime) - (a.options.lastCommitTime || a.options.modifyTime)
      },
      useArticleTitle: true // å…¨å±€å¼€å¯ä½¿ç”¨æ–‡ç« ä¸€çº§æ ‡é¢˜ä½œä¸ºæ–‡ç« åç§°
    }),
  ],
}
```

## License

[MIT](./LICENSE) License Â© 2023 [Xaviw](https://github.com/Xaviw)
